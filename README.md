# PingCAP Hackathon 2021

## 项目名称

以系统用量为收费模型的 TiDB 多租户原型探索

## 成员介绍

队长: @Yisaer 队员: @longfangsong @AT-Fieldless @systemX1

## 项目介绍

本项目会以用户为单位，收集并聚合每个用户在整个 TiDB 集群上的 CPU 用量(只包含 TiDB 与 TiKV)和存储用量(只包含 TiKV)，以内部系统表、监控的方式展现出来各个用户的系统资源用量，同时改造部分 TiDB 系统表，从而使得用户可以看到自己租户视角下的 TiDB 系统表情况而非整个大集群的系统表情况。

## 背景

数据库与云的结合一直是这两年大家津津乐道的话题。通过云，我们能得到弹性的计算与存储资源，而在数据库里，用户的计算与存储负载也大部分是具备弹性以及会逐渐成长。

该项目目的在于探索 TiDB 多租户 Serveless 计费的基础原型，通过以一个大集群服务多个租户的形式，并且通过 CPU 用量与存储用量的模式对客户的 TiDB 使用情况进行收费。

## 项目设计

在 TiDB 侧，我们将统计并上报用户每条 SQL 在计算层的 CPU 使用量并定时上报给数据收集端。在 TiKV 侧，我们将统计并上报用户数据所对应的各个 Region 在单位时间内的 CPU 用量与用户整体的存储用量。最后将所有得到的数据以用户为单位进行聚合。
